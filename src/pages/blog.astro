---
import { getCollection } from "astro:content";
import MainLayout from "../layouts/MainLayout.astro";

const posts = await getCollection("blog", ({ data }) => !data.draft);
---

<MainLayout title="Blog | Nickyt.live">
  <h1>Blog</h1>
  <ul style="list-style: none; padding: 0;">
    {
      posts
        .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
        .map((post) => (
          <li style="margin-bottom: 2.5rem; border-bottom: 1px solid #eee; padding-bottom: 2rem;">
            {post.data.cover_image && (
              <a href={`/blog/${post.slug}/`} aria-hidden="true">
                <img
                  src={post.data.cover_image}
                  alt={post.data.title}
                  class="hidden md:block w-1/2 aspect-auto mb-4 rounded"
                  width={861}
                  height={361}
                />
              </a>
            )}
            <h2 style="margin: 0 0 0.5rem 0;">
              <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
            </h2>
            <small style="color: #888;">
              {post.data.date.toLocaleDateString()}
            </small>
            {post.data.description && (
              <p style="margin-top: 0.5rem; color: #444;">
                {post.data.description}
              </p>
            )}
            {post.data.tags && post.data.tags.length > 0 && (
              <div style="margin-top: 0.5rem;">
                {post.data.tags.map((tag) => (
                  <span style="background: #f0f0f0; color: #555; padding: 0.2em 0.6em; margin-right: 0.5em; border-radius: 3px; font-size: 0.9em;">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </li>
        ))
    }
  </ul>
</MainLayout>
