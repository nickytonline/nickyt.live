---
import { getCollection } from "astro:content";
import Layout from "../layouts/MainLayout.astro";
import TagList from "../components/TagList.astro";

const blog = await getCollection("blog");
const sortedBlog = blog
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<Layout title="Blog | Nick Taylor">
  <main class="mt-4 md:mt-8 lg:mt-16 grid gap-8">
    <h1>Blog</h1>
    <a href="/tags">Browse posts by tag</a>
    <ul class="grid gap-8">
      {
        sortedBlog.map((post) => {
          const slug = post.id.replace(/^blog\//, "").replace(/\.md$/, "");
          return (
            <li>
              <a href={`/blog/${slug}`} class="block group">
                <article class="flex gap-4">
                  {post.data.image && (
                    <div class="hidden md:block flex-shrink-0 w-48 h-27">
                      <img
                        src={post.data.image.url}
                        alt={post.data.image.alt || ""}
                        aria-hidden="true"
                        class="w-full h-full object-cover rounded"
                        loading="lazy"
                      />
                    </div>
                  )}
                  <div>
                    <h2>
                      <a href={`/blog/${slug}`}>{post.data.title}</a>
                    </h2>
                    {post.data.description && (
                      <p class="mt-2 text-gray-600">{post.data.description}</p>
                    )}
                    <div>
                      <time datetime={post.data.date.toISOString()}>
                        {post.data.date.toLocaleDateString("en-US", {
                          year: "numeric",
                          month: "long",
                          day: "numeric",
                        })}
                      </time>
                      {post.data.featured && (
                        <>
                          {" \u2022 "}
                          <span class="text-pink-600 font-medium">
                            Featured
                          </span>
                        </>
                      )}
                    </div>
                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="mt-2">
                        <TagList tags={post.data.tags} limit={3} />
                      </div>
                    )}
                  </div>
                </article>
              </a>
            </li>
          );
        })
      }
    </ul>
    <a href="/tags">Browse posts by tag</a>
  </main>
</Layout>
