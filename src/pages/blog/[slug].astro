---
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";

export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}
const { post } = Astro.props;
const { Content } = await post.render();
const { title, date, description, tags, cover_image, canonicalUrl } = post.data;
---

<MainLayout title={`${title} | Blog | Nickyt.live`}>
  {description && <meta name="description" content={description} />}
  <article>
    {
      cover_image && (
        <img
          src={cover_image}
          alt=""
          style="max-width: 100%; height: auto; margin: 1.5rem 0;"
        />
      )
    }
    <h1>{title}</h1>
    <time datetime={post.data.date.toISOString()}>
      {
        post.data.date.toLocaleDateString("en-US", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        })
      }
    </time>
    {
      tags && tags.length > 0 && (
        <ul class="mt-2 flex gap-2">
          {tags.map((tag) => (
            <li>
              <a
                href={`/tags/${encodeURIComponent(tag)}/`}
                class="bg-pink-600 text-white px-2 py-1 rounded"
              >
                {tag}
              </a>
            </li>
          ))}
        </ul>
      )
    }

    {/* Description is now in the meta tag, not rendered in-body */}
    {
      Content ? (
        <div class="prose prose-lg">
          <Content />
        </div>
      ) : (
        <p>Sorry, this post could not be rendered.</p>
      )
    }
  </article>
</MainLayout>
