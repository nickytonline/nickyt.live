---
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";

export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}
const { post } = Astro.props;
const { Content } = await post.render();
const { title, date, description, tags, cover_image, canonicalUrl } = post.data;
---

<MainLayout title={`${title} | Blog | Nickyt.live`}>
  {description && <meta name="description" content={description} />}
  <article>
    <h1>{title}</h1>
    <small style="color: #888;">{date}</small>
    {
      cover_image && (
        <img
          src={cover_image}
          alt=""
          style="max-width: 100%; height: auto; margin: 1.5rem 0;"
        />
      )
    }
    {
      tags && tags.length > 0 && (
        <div style="margin-bottom: 1rem;">
          {tags.map((tag) => (
            <span style="background: #f0f0f0; color: #555; padding: 0.2em 0.6em; margin-right: 0.5em; border-radius: 3px; font-size: 0.9em;">
              {tag}
            </span>
          ))}
        </div>
      )
    }
    {/* Description is now in the meta tag, not rendered in-body */}
    {
      Content ? (
        <div class="prose prose-lg">
          <Content />
        </div>
      ) : (
        <p>Sorry, this post could not be rendered.</p>
      )
    }
  </article>
</MainLayout>
